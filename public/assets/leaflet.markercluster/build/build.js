function lintFiles(e){var r,n,o,s,t,i,l=0;for(r=0,o=e.length;o>r;r++){for(jshint.JSHINT(fs.readFileSync(e[r],"utf8"),hintrc,r?{L:!0}:null),t=jshint.JSHINT.errors,n=0,s=t.length;s>n;n++)i=t[n],console.log(e[r]+"	line "+i.line+"	col "+i.character+"	 "+i.reason);l+=s}return l}function getFiles(e){function r(e){for(var r=0,n=e.length;n>r;r++)o[e[r]]=!0}var n,o={};e&&(n=parseInt(e,32).toString(2).split(""),console.log("Managing dependencies..."));for(var s in deps)n?1===parseInt(n.pop(),2)?(console.log("	* "+s),r(deps[s].src)):console.log("	  "+s):r(deps[s].src);var t=[];for(var i in o)t.push("src/"+i);return t}function getSizeDelta(e,r){if(!r)return"new";var n=e.replace(/\r\n?/g,"\n").length,o=r.replace(/\r\n?/g,"\n").length,s=n-o;return(s>=0?"+":"")+s}function loadSilently(e){try{return fs.readFileSync(e,"utf8")}catch(r){return null}}function combineFiles(e){for(var r="",n=0,o=e.length;o>n;n++)r+=fs.readFileSync(e[n],"utf8")+"\n\n";return r}var fs=require("fs"),jshint=require("jshint"),UglifyJS=require("uglify-js"),deps=require("./deps.js").deps,hintrc=require("./hintrc.js").config;exports.getFiles=getFiles,exports.lint=function(){var e=getFiles();console.log("Checking for JS errors...");var r=lintFiles(e);r>0?(console.log(r+" error(s) found.\n"),fail()):console.log("	Check passed")},exports.build=function(e,r){var n=getFiles(e);console.log("Concatenating "+n.length+" files...");var o=fs.readFileSync("src/copyright.js","utf8"),s="(function (window, document, undefined) {",t="}(window, document));",i=o+s+combineFiles(n)+t,l="dist/leaflet.markercluster"+(r?"-"+r:""),c=l+"-src.js",a=loadSilently(c),g=getSizeDelta(i,a);console.log("	Uncompressed size: "+i.length+" bytes ("+g+")"),i===a?console.log("	No changes"):(fs.writeFileSync(c,i),console.log("	Saved to "+c)),console.log("Compressing...");var f=l+".js",u=loadSilently(f),p=o+UglifyJS.minify(i,{warnings:!0,fromString:!0}).code,d=getSizeDelta(p,u);console.log("	Compressed size: "+p.length+" bytes ("+d+")"),p===u?console.log("	No changes"):(fs.writeFileSync(f,p),console.log("	Saved to "+f))},exports.test=function(){function e(e){return-1!==process.argv.indexOf(e)}var r=require("karma"),n={configFile:__dirname+"/../spec/karma.conf.js"};n.browsers=["PhantomJS"],e("--chrome")&&n.browsers.push("Chrome"),e("--safari")&&n.browsers.push("Safari"),e("--ff")&&n.browsers.push("Firefox"),e("--ie")&&n.browsers.push("IE"),e("--cov")&&(n.preprocessors={"../src/**/*.js":"coverage"},n.coverageReporter={type:"html",dir:"coverage/"},n.reporters=["coverage"]),r.server.start(n)};
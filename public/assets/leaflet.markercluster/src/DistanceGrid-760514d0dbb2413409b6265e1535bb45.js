L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,i){var e=this._getCoord(i.x),o=this._getCoord(i.y),r=this._grid,s=r[o]=r[o]||{},n=s[e]=s[e]||[],h=L.Util.stamp(t);this._objectPoint[h]=i,n.push(t)},updateObject:function(t,i){this.removeObject(t),this.addObject(t,i)},removeObject:function(t,i){var e,o,r=this._getCoord(i.x),s=this._getCoord(i.y),n=this._grid,h=n[s]=n[s]||{},c=h[r]=h[r]||[];for(delete this._objectPoint[L.Util.stamp(t)],e=0,o=c.length;o>e;e++)if(c[e]===t)return c.splice(e,1),1===o&&delete h[r],!0},eachObject:function(t,i){var e,o,r,s,n,h,c,l=this._grid;for(e in l){n=l[e];for(o in n)for(h=n[o],r=0,s=h.length;s>r;r++)c=t.call(i,h[r]),c&&(r--,s--)}},getNearObject:function(t){var i,e,o,r,s,n,h,c,l=this._getCoord(t.x),_=this._getCoord(t.y),d=this._objectPoint,f=this._sqCellSize,a=null;for(i=_-1;_+1>=i;i++)if(r=this._grid[i])for(e=l-1;l+1>=e;e++)if(s=r[e])for(o=0,n=s.length;n>o;o++)h=s[o],c=this._sqDist(d[L.Util.stamp(h)],t),f>c&&(f=c,a=h);return a},_getCoord:function(t){return Math.floor(t/this._cellSize)},_sqDist:function(t,i){var e=i.x-t.x,o=i.y-t.y;return e*e+o*o}};
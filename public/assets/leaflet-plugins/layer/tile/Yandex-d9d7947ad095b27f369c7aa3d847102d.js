L.Yandex=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,attribution:"",opacity:1,traffic:!1},possibleShortMapTypes:{schemaMap:"map",satelliteMap:"satellite",hybridMap:"hybrid",publicMap:"publicMap",publicMapInHybridView:"publicMapHybrid"},_getPossibleMapType:function(t){var i="yandex#map";if("string"!=typeof t)return i;for(var e in this.possibleShortMapTypes){if(t===this.possibleShortMapTypes[e]){i="yandex#"+t;break}t==="yandex#"+this.possibleShortMapTypes[e]&&(i=t)}return i},initialize:function(t,i){L.Util.setOptions(this,i),this._type=this._getPossibleMapType(t)},onAdd:function(t,i){this._map=t,this._insertAtTheBottom=i,this._initContainer(),this._initMapObject(),t.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),t.on("move",this._update,this),t._controlCorners.bottomright.style.marginBottom="3em",this._reset(),this._update(!0)},onRemove:function(t){this._map._container.removeChild(this._container),this._map.off("viewreset",this._resetCallback,this),this._map.off("move",this._update,this),t._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(t){this.options.opacity=t,1>t&&L.DomUtil.setOpacity(this._container,t)},setElementSize:function(t,i){t.style.width=i.x+"px",t.style.height=i.y+"px"},_initContainer:function(){var t=this._map._container,i=t.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-yandex-layer leaflet-top leaflet-left"),this._container.id="_YMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),this.options.overlay&&(i=this._map._container.getElementsByClassName("leaflet-map-pane")[0],i=i.nextSibling,L.Browser.opera&&(this._container.className+=" leaflet-objects-pane")),t.insertBefore(this._container,i),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(!this._yandex){if(void 0===ymaps.Map)return console&&console.debug('L.Yandex: Waiting on ymaps.load("package.map")'),ymaps.load(["package.map"],this._initMapObject,this);if(this.options.traffic&&(void 0===ymaps.control||void 0===ymaps.control.TrafficControl))return console&&console.debug("L.Yandex: loading traffic and controls"),ymaps.load(["package.traffic","package.controls"],this._initMapObject,this);var t=new ymaps.Map(this._container,{center:[0,0],zoom:0,behaviors:[],controls:[]});this.options.traffic&&t.controls.add(new ymaps.control.TrafficControl({shown:!0})),"yandex#null"===this._type&&(this._type=new ymaps.MapType("null",[]),t.container.getElement().style.background="transparent"),t.setType(this._type),this._yandex=t,this._update(!0),this.fire("MapObjectInitialized",{mapObject:t})}},_resetCallback:function(t){this._reset(t.hard)},_reset:function(){this._initContainer()},_update:function(t){if(this._yandex){this._resize(t);var i=this._map.getCenter(),e=[i.lat,i.lng],a=this._map.getZoom();(t||this._yandex.getZoom()!==a)&&this._yandex.setZoom(a),this._yandex.panTo(e,{duration:0,delay:0})}},_resize:function(t){var i=this._map.getSize(),e=this._container.style;if(e.width!==i.x+"px"||e.height!==i.y+"px"||t===!0){this.setElementSize(this._container,i);{var a=this._map.getBounds();a.getSouthWest(),a.getNorthEast()}this._yandex.container.fitToViewport()}}});